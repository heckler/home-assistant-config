homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret home_elevation
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: America/Sao_Paulo
  # Customization file
  customize: !include customize.yaml

  # configuration for casting: 
  # (see https://community.home-assistant.io/t/using-catt/130332/15 )
  auth_providers:
    - type: trusted_networks
      trusted_networks:
        - 192.168.6.0/24
        - 192.168.0.0/24
        - fd00::/8
      allow_bypass_login: true


# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:


# load themes from a subfolder containing configs:
frontend:
   #themes: !include_dir_merge_named themes/


# Show the introduction message on startup.
# introduction:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
# http:
#   base_url: example.duckdns.org:8123


# ----------------------------------------------------------------------------------
# Recorder configuration - limit which entities have history preserved
# ----------------------------------------------------------------------------------
recorder:
  purge_interval: 0
  commit_interval: 10
  include:
    entities:
      - sensor.balcony_humidity
      - sensor.balcony_temperature
      - sensor.emoncms_home_power
      - sensor.emoncms_home_power_kwh
      - sensor.emoncms_node_emontx3_a_powera
      - sensor.emoncms_node_emontx3_a_powera_kwh
      - sensor.emoncms_node_emontx3_a_vrms
      - sensor.emoncms_node_emontx3_b_powerb
      - sensor.emoncms_node_emontx3_b_powerb_kwh
      - sensor.emoncms_node_emontx3_b_vrms
      - sensor.emoncms_node_emontx3_c_powerc
      - sensor.emoncms_node_emontx3_c_powerc_kwh
      - sensor.emoncms_node_emontx3_c_vrms
      - sensor.nh_to_chacara
      - sensor.nh_to_poa
      - sensor.poa_to_nh
      - sensor.speedtest_ping
      - sensor.speedtest_upload
      - sensor.speedtest_download
      - sensor.brazil_coronavirus_deaths
      - sensor.brazil_coronavirus_current


# ----------------------------------------------------------------------------------
# InfluxDB configuration
# ----------------------------------------------------------------------------------
influxdb:
  host: a0d7b954-influxdb
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_password
  max_retries: 3
  default_measurement: state
  include:
    entities:
      - sensor.balcony_humidity
      - sensor.balcony_temperature
      - sensor.emoncms_home_power
      - sensor.emoncms_home_power_kwh
      - sensor.emoncms_node_emontx3_a_powera
      - sensor.emoncms_node_emontx3_a_powera_kwh
      - sensor.emoncms_node_emontx3_a_vrms
      - sensor.emoncms_node_emontx3_b_powerb
      - sensor.emoncms_node_emontx3_b_powerb_kwh
      - sensor.emoncms_node_emontx3_b_vrms
      - sensor.emoncms_node_emontx3_c_powerc
      - sensor.emoncms_node_emontx3_c_powerc_kwh
      - sensor.emoncms_node_emontx3_c_vrms
      - sensor.nh_to_chacara
      - sensor.nh_to_poa
      - sensor.poa_to_nh
      - sensor.speedtest_ping
      - sensor.speedtest_upload
      - sensor.speedtest_download
      - sensor.brazil_coronavirus_deaths
      - sensor.brazil_coronavirus_current
      - sensor.balcony_02_pressure
  component_config_glob:
    sensor.*humidity:
      override_measurement: humidity
    sensor.*temperature:
      override_measurement: temperature
    sensor.*pressure:
      override_measurement: pressure



# perform an internet speed test every hour:
speedtestdotnet:


# weather platforms
weather:
  - platform: darksky
    name: weather-1
    api_key: !secret darksky_api_key
  - platform: met
    name: weather-2


updater:
  include_used_components: true


# Transmission integration
#transmission:
#  host: !secret transmission_host
#  port: !secret transmission_port
#  username: !secret transmission_user
#  password: !secret transmission_passord


# ----------------------------------------------------------------------------------
# Sensors
# ----------------------------------------------------------------------------------
sensor:

  # waze travel time calculator
  # using a card from: https://github.com/ljmerza/travel-time-card
  - platform: waze_travel_time
    name: NH to POA
    origin: !secret home_coordinates
    destination: !secret work_coordinates
    region: 'EU'
  - platform: waze_travel_time
    name: POA to NH
    origin: !secret work_coordinates
    destination: !secret home_coordinates
    region: 'EU'
  - platform: waze_travel_time
    name: NH to Chacara
    origin: !secret home_coordinates
    destination: !secret chacara_coordinates
    region: 'EU'


  # System monitor: CPU, Memory and disk:
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_use_percent
      - type: load_1m
      - type: swap_free
      - type: last_boot


  # CPU temperature, using commmand_line sensor:
  - platform: command_line
    name: CPU Temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "Â°C"
    value_template: '{{ value | multiply(0.001) | round(1) }}'


  # ----------------------------------------------------------------------------------
  # EmonCMS sensor patform, CAH 2019-10-25
  # info:  https://www.home-assistant.io/integrations/emoncms
  # feeds: http://emonpi/emoncms/feed/list
  # ----------------------------------------------------------------------------------
  # faster update for the instant power and current feeds
  - platform: emoncms
    api_key: !secret emoncms_api_key
    url: http://emonpi.local/emoncms/
    id: 1
    scan_interval: 10
    include_only_feed_id:
      - 2
      - 5
      - 3
      - 8
      - 4
      - 10
      - 17
  # slower update rate for the accumulated power feeds
  - platform: emoncms
    api_key: !secret emoncms_api_key
    url: http://emonpi.local/emoncms/
    id: 1
    scan_interval: 60
    include_only_feed_id:
      - 6
      - 9
      - 11
      - 18


  # Date/Time sensor is used to allow automation templates which get triggered (re-evaluated) every minute
  - platform: time_date
    display_options:
    - "date_time_utc"


# Text to speech
tts:
  - platform: google_translate
    service_name: google_say


# ----------------------------------------------------------------------------------
# Slack Notification settings
# ----------------------------------------------------------------------------------
notify:
  - platform: slack
    name: slack
    api_key: !secret slack_api_key
    default_channel: '#home-automation'


# ----------------------------------------------------------------------------------
# iFrame panel: extra links
# info: https://www.home-assistant.io/integrations/panel_iframe/
# ----------------------------------------------------------------------------------
panel_iframe:
  emon_cms:
    title: 'EmonCMS'
    url: 'http://emonpi.local/emoncms/dashboard/view/cah'



group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
